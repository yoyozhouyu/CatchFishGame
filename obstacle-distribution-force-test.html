<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>éšœç¢ç‰©åˆ†å¸ƒå’Œé±¼çº¿åŠ›æ•ˆæœæµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            background: linear-gradient(to bottom, #87CEEB 0%, #4682B4 30%, #191970 100%);
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            touch-action: none;
        }

        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #gameCanvas {
            background: linear-gradient(to bottom, 
                rgba(135, 206, 235, 0.8) 0%,
                rgba(70, 130, 180, 0.9) 20%,
                rgba(25, 25, 112, 0.95) 50%,
                rgba(0, 0, 139, 1) 100%);
            border: 2px solid #4682B4;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            touch-action: none;
        }

        .info-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            max-width: 350px;
            z-index: 100;
        }

        .controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 12px;
            text-align: center;
            z-index: 100;
        }

        .back-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .test-button {
            background: rgba(76, 175, 80, 0.8);
            border: 2px solid rgba(76, 175, 80, 1);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            margin: 5px;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .test-button:hover {
            background: rgba(76, 175, 80, 1);
            transform: translateY(-2px);
        }

        .status-panel {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 12px;
            min-width: 280px;
            z-index: 100;
        }

        .obstacle-layer {
            margin: 5px 0;
            padding: 8px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
        }

        .surface-layer {
            border-left: 4px solid #87CEEB;
        }

        .mid-upper-layer {
            border-left: 4px solid #4682B4;
        }

        .mid-layer {
            border-left: 4px solid #191970;
        }

        .deep-layer {
            border-left: 4px solid #000080;
        }

        .test-info {
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 12px;
            width: 250px;
            z-index: 100;
        }

        .force-info {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
        }

        .high-tension {
            border-left: 4px solid #ff4444;
            background: rgba(255, 68, 68, 0.2);
        }

        .medium-tension {
            border-left: 4px solid #ff9800;
            background: rgba(255, 152, 0, 0.2);
        }

        .low-tension {
            border-left: 4px solid #4CAF50;
            background: rgba(76, 175, 80, 0.2);
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <a href="demo.html" class="back-button">â† è¿”å›æ¼”ç¤ºé¡µé¢</a>
        
        <canvas id="gameCanvas"></canvas>
        
        <div class="info-panel">
            <h3>ğŸŒŠ éšœç¢ç‰©åˆ†å¸ƒå’Œé±¼çº¿åŠ›æ•ˆæœæµ‹è¯•</h3>
            <p><strong>æ–°åŠŸèƒ½ç‰¹ç‚¹ï¼š</strong></p>
            <ul style="margin: 10px 0; padding-left: 20px; font-size: 12px;">
                <li>âœ… éšœç¢ç‰©åˆ†å±‚åˆ†å¸ƒï¼ˆè¶Šæ·±è¶Šå¤šï¼‰</li>
                <li>âœ… å¢å¼ºé±¼çº¿è¿æ¥åŒæ–¹åŠ›æ•ˆæœ</li>
                <li>âœ… æ›´å¼ºçš„æ‹‰æ‹½å’Œåä½œç”¨åŠ›</li>
                <li>âœ… å¿«é€Ÿæ¸¸åŠ¨å¢åŠ é¢å¤–å¼ åŠ›</li>
                <li>âœ… ç–²åŠ³é±¼ç±»æ›´æ˜“æ‹–æ‹½</li>
            </ul>
            <div style="margin: 10px 0;">
                <button class="test-button" onclick="shootDeepFish()">å°„å‡»æ·±å±‚é±¼ç±»</button>
                <button class="test-button" onclick="testPullForce()">æµ‹è¯•æ‹‰æ‹½åŠ›</button>
                <button class="test-button" onclick="showObstacleInfo()">æ˜¾ç¤ºéšœç¢ç‰©ä¿¡æ¯</button>
                <button class="test-button" onclick="toggleCollisionBoxes()">åˆ‡æ¢ç¢°æ’æ¡†</button>
            </div>
            <div style="margin: 10px 0; font-size: 12px;">
                <div><strong>åˆ†å±‚åˆ†å¸ƒï¼š</strong></div>
                <div>æ°´é¢å±‚(10-25%): 3ä¸ªéšœç¢ç‰©</div>
                <div>ä¸­ä¸Šå±‚(25-50%): 6ä¸ªéšœç¢ç‰©</div>
                <div>ä¸­å±‚(50-70%): 8ä¸ªéšœç¢ç‰©</div>
                <div>æ·±å±‚(70-90%): 12ä¸ªéšœç¢ç‰©</div>
            </div>
        </div>

        <div class="status-panel" id="statusPanel">
            <h4>ğŸ“Š éšœç¢ç‰©åˆ†å¸ƒç»Ÿè®¡</h4>
            <div id="obstacleStats">
                <!-- éšœç¢ç‰©ç»Ÿè®¡å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>

        <div class="test-info" id="testInfo">
            <h4>âš¡ é±¼çº¿åŠ›æ•ˆæœç›‘æ§</h4>
            <div id="forceInfo">
                <div class="force-info">ç­‰å¾…é±¼çº¿è¿æ¥...</div>
            </div>
        </div>

        <div class="controls">
            <strong>æµ‹è¯•æ–¹æ³•ï¼š</strong> å°„å‡»æ·±å±‚é±¼ç±»è§‚å¯Ÿéšœç¢ç‰©åˆ†å¸ƒ â†’ æ‹‰æ‹½é±¼çº¿æ„Ÿå—å¢å¼ºçš„åŠ›æ•ˆæœ
        </div>
    </div>

    <script src="game.js"></script>
    <script>
        let game = null;
        let showingObstacleInfo = false;

        // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆåå¯åŠ¨æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', () => {
            // åˆ›å»ºæ¸¸æˆå®ä¾‹
            game = new UnderwaterHuntingGame();
            
            // ç­‰å¾…æ¸¸æˆåˆå§‹åŒ–å®Œæˆ
            setTimeout(() => {
                if (game && game.settings) {
                    game.settings.showCollisionBoxes = false;
                    console.log('éšœç¢ç‰©åˆ†å¸ƒå’Œé±¼çº¿åŠ›æ•ˆæœæµ‹è¯•æ¨¡å¼å¯åŠ¨');
                    
                    // å¼€å§‹çŠ¶æ€æ›´æ–°å¾ªç¯
                    updateStatus();
                    updateObstacleStats();
                }
            }, 2000);
        });

        // å°„å‡»æ·±å±‚é±¼ç±»
        function shootDeepFish() {
            if (!game || !game.fishes) return;
            
            // æ‰¾åˆ°æœ€æ·±å±‚çš„é±¼
            let deepestFish = null;
            let maxDepth = 0;
            
            game.fishes.forEach(fish => {
                if (!fish.isCaught && fish.y > maxDepth) {
                    maxDepth = fish.y;
                    deepestFish = fish;
                }
            });
            
            if (deepestFish) {
                // å°„å‡»è¿™æ¡é±¼
                const dx = deepestFish.x - game.player.x;
                const dy = deepestFish.y - game.player.y;
                
                game.input.mouse.x = game.player.x + dx;
                game.input.mouse.y = game.player.y + dy;
                
                game.handleShoot();
                console.log(`å°„å‡»æ·±å±‚${deepestFish.type}é±¼ï¼Œæ·±åº¦: ${Math.round((deepestFish.y / game.gameHeight) * 100)}%`);
            }
        }

        // æµ‹è¯•æ‹‰æ‹½åŠ›
        function testPullForce() {
            if (!game || !game.fishingLine) {
                alert('è¯·å…ˆå°„å‡»é±¼ç±»å»ºç«‹è¿æ¥');
                return;
            }
            
            // æ¨¡æ‹ŸæŒç»­æ‹‰æ‹½3ç§’
            game.input.keys['Space'] = true;
            setTimeout(() => {
                game.input.keys['Space'] = false;
                console.log('æ‹‰æ‹½åŠ›æµ‹è¯•å®Œæˆ');
            }, 3000);
            
            console.log('å¼€å§‹3ç§’æ‹‰æ‹½åŠ›æµ‹è¯•');
        }

        // æ˜¾ç¤ºéšœç¢ç‰©ä¿¡æ¯
        function showObstacleInfo() {
            showingObstacleInfo = !showingObstacleInfo;
            game.settings.showCollisionBoxes = showingObstacleInfo;
            console.log(`éšœç¢ç‰©ä¿¡æ¯æ˜¾ç¤º: ${showingObstacleInfo ? 'å¼€å¯' : 'å…³é—­'}`);
        }

        // åˆ‡æ¢ç¢°æ’æ¡†æ˜¾ç¤º
        function toggleCollisionBoxes() {
            game.settings.showCollisionBoxes = !game.settings.showCollisionBoxes;
            console.log(`ç¢°æ’æ¡†æ˜¾ç¤º: ${game.settings.showCollisionBoxes ? 'å¼€å¯' : 'å…³é—­'}`);
        }

        // æ›´æ–°éšœç¢ç‰©ç»Ÿè®¡
        function updateObstacleStats() {
            if (!game || !game.obstacles) return;
            
            const statsDiv = document.getElementById('obstacleStats');
            
            // æŒ‰æ·±åº¦åˆ†å±‚ç»Ÿè®¡
            const layers = {
                surface: { name: 'æ°´é¢å±‚(10-25%)', count: 0, obstacles: [] },
                midUpper: { name: 'ä¸­ä¸Šå±‚(25-50%)', count: 0, obstacles: [] },
                mid: { name: 'ä¸­å±‚(50-70%)', count: 0, obstacles: [] },
                deep: { name: 'æ·±å±‚(70-90%)', count: 0, obstacles: [] }
            };
            
            game.obstacles.forEach((obstacle, index) => {
                const depthPercent = obstacle.y / game.gameHeight;
                
                if (depthPercent <= 0.25) {
                    layers.surface.count++;
                    layers.surface.obstacles.push(obstacle);
                } else if (depthPercent <= 0.5) {
                    layers.midUpper.count++;
                    layers.midUpper.obstacles.push(obstacle);
                } else if (depthPercent <= 0.7) {
                    layers.mid.count++;
                    layers.mid.obstacles.push(obstacle);
                } else {
                    layers.deep.count++;
                    layers.deep.obstacles.push(obstacle);
                }
            });
            
            statsDiv.innerHTML = '';
            
            Object.keys(layers).forEach(key => {
                const layer = layers[key];
                const layerDiv = document.createElement('div');
                layerDiv.className = `obstacle-layer ${key}-layer`;
                
                layerDiv.innerHTML = `
                    <div><strong>${layer.name}</strong></div>
                    <div>æ•°é‡: ${layer.count}</div>
                    <div>ç±»å‹: ${layer.obstacles.map(o => o.obstacleType).join(', ')}</div>
                `;
                
                statsDiv.appendChild(layerDiv);
            });
        }

        // æ›´æ–°åŠ›æ•ˆæœç›‘æ§
        function updateStatus() {
            if (!game) return;
            
            const forceInfoDiv = document.getElementById('forceInfo');
            
            if (game.fishingLine && !game.fishingLine.broken) {
                const tension = game.fishingLine.tension;
                const fish = game.fishingLine.fish;
                const player = game.player;
                
                let tensionClass = 'low-tension';
                if (tension > 0.7) {
                    tensionClass = 'high-tension';
                } else if (tension > 0.4) {
                    tensionClass = 'medium-tension';
                }
                
                forceInfoDiv.innerHTML = `
                    <div class="force-info ${tensionClass}">
                        <div><strong>ğŸ£ é±¼çº¿è¿æ¥çŠ¶æ€</strong></div>
                        <div>å¼ åŠ›: ${Math.round(tension * 100)}%</div>
                        <div>é•¿åº¦: ${Math.round(game.fishingLine.currentLength)}px</div>
                        <div>è€ä¹…: ${Math.round((game.fishingLine.durability / game.fishingLine.maxDurability) * 100)}%</div>
                    </div>
                    <div class="force-info">
                        <div><strong>ğŸŸ é±¼ç±»çŠ¶æ€</strong></div>
                        <div>ç±»å‹: ${fish.type}é±¼</div>
                        <div>ä½“åŠ›: ${Math.round(fish.stamina)}/${fish.maxStamina}</div>
                        <div>å¿«é€Ÿæ¸¸åŠ¨: ${fish.isFastSwimming ? 'æ˜¯' : 'å¦'}</div>
                        <div>ç–²åŠ³: ${fish.isExhausted ? 'æ˜¯' : 'å¦'}</div>
                    </div>
                    <div class="force-info">
                        <div><strong>ğŸ¯ ç©å®¶çŠ¶æ€</strong></div>
                        <div>ä½“åŠ›: ${Math.round(player.stamina)}/${player.maxStamina}</div>
                        <div>æ‹‰æ‹½ä¸­: ${player.isPulling ? 'æ˜¯' : 'å¦'}</div>
                        <div>é€Ÿåº¦: ${Math.round(Math.sqrt(player.vx * player.vx + player.vy * player.vy) * 10) / 10}</div>
                    </div>
                `;
            } else {
                forceInfoDiv.innerHTML = '<div class="force-info">ç­‰å¾…é±¼çº¿è¿æ¥...</div>';
            }
            
            // ç»§ç»­æ›´æ–°
            setTimeout(updateStatus, 200);
        }
    </script>
</body>
</html>
