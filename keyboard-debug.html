<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é”®ç›˜è¾“å…¥è°ƒè¯•å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
        }

        .debug-panel {
            background: rgba(0, 255, 0, 0.1);
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .keyboard-layout {
            display: grid;
            gap: 5px;
            margin: 20px 0;
            justify-content: center;
        }

        .keyboard-row {
            display: flex;
            gap: 5px;
            justify-content: center;
        }

        .key {
            background: #333;
            border: 2px solid #555;
            color: #ccc;
            padding: 10px;
            border-radius: 5px;
            min-width: 40px;
            text-align: center;
            font-family: monospace;
            font-weight: bold;
            transition: all 0.1s ease;
        }

        .key.active {
            background: #00ff00;
            color: #000;
            box-shadow: 0 0 15px #00ff00;
            transform: scale(1.1);
        }

        .key.wide {
            min-width: 80px;
        }

        .key.extra-wide {
            min-width: 120px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .info-panel {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00ff00;
            border-radius: 8px;
            padding: 15px;
        }

        .event-log {
            background: #000;
            border: 2px solid #00ff00;
            border-radius: 8px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }

        .event-entry {
            margin: 2px 0;
            padding: 2px 5px;
        }

        .event-keydown {
            color: #00ff00;
        }

        .event-keyup {
            color: #ff6600;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
        }

        .stats-table th,
        .stats-table td {
            border: 1px solid #00ff00;
            padding: 8px;
            text-align: left;
        }

        .stats-table th {
            background: rgba(0, 255, 0, 0.2);
        }

        .clear-button {
            background: #ff3333;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-family: monospace;
            font-weight: bold;
        }

        .clear-button:hover {
            background: #ff5555;
        }

        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 255, 0, 0.2);
            border: 2px solid #00ff00;
            color: #00ff00;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(0, 255, 0, 0.3);
            box-shadow: 0 0 10px #00ff00;
        }
    </style>
</head>
<body>
    <a href="demo.html" class="back-button">â† è¿”å›æ¼”ç¤ºé¡µé¢</a>
    
    <div class="container">
        <h1>âŒ¨ï¸ é”®ç›˜è¾“å…¥è°ƒè¯•å·¥å…·</h1>
        
        <div class="debug-panel">
            <h2>ğŸ® æ¸¸æˆæ§åˆ¶é”®ä½</h2>
            <div class="keyboard-layout">
                <div class="keyboard-row">
                    <div class="key" data-key="KeyQ">Q</div>
                    <div class="key" data-key="KeyW">W</div>
                    <div class="key" data-key="KeyE">E</div>
                    <div class="key" data-key="KeyR">R</div>
                </div>
                <div class="keyboard-row">
                    <div class="key" data-key="KeyA">A</div>
                    <div class="key" data-key="KeyS">S</div>
                    <div class="key" data-key="KeyD">D</div>
                    <div class="key" data-key="KeyF">F</div>
                </div>
                <div class="keyboard-row">
                    <div class="key wide" data-key="ShiftLeft">Shift</div>
                    <div class="key extra-wide" data-key="Space">Space</div>
                    <div class="key wide" data-key="ShiftRight">Shift</div>
                </div>
                <div class="keyboard-row">
                    <div class="key" data-key="ArrowUp">â†‘</div>
                    <div class="key" data-key="ArrowDown">â†“</div>
                    <div class="key" data-key="ArrowLeft">â†</div>
                    <div class="key" data-key="ArrowRight">â†’</div>
                </div>
            </div>
        </div>

        <div class="info-grid">
            <div class="info-panel">
                <h3>ğŸ“Š æŒ‰é”®ç»Ÿè®¡</h3>
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>æŒ‰é”®</th>
                            <th>æŒ‰ä¸‹æ¬¡æ•°</th>
                            <th>çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody id="statsTable">
                        <tr><td>W (ä¸Š)</td><td id="countW">0</td><td id="statusW">é‡Šæ”¾</td></tr>
                        <tr><td>A (å·¦)</td><td id="countA">0</td><td id="statusA">é‡Šæ”¾</td></tr>
                        <tr><td>S (ä¸‹)</td><td id="countS">0</td><td id="statusS">é‡Šæ”¾</td></tr>
                        <tr><td>D (å³)</td><td id="countD">0</td><td id="statusD">é‡Šæ”¾</td></tr>
                        <tr><td>Shift (åŠ é€Ÿ)</td><td id="countShift">0</td><td id="statusShift">é‡Šæ”¾</td></tr>
                        <tr><td>Space (å°„å‡»)</td><td id="countSpace">0</td><td id="statusSpace">é‡Šæ”¾</td></tr>
                    </tbody>
                </table>
                <button class="clear-button" onclick="clearStats()">æ¸…é™¤ç»Ÿè®¡</button>
            </div>

            <div class="info-panel">
                <h3>ğŸ” å½“å‰æŒ‰é”®çŠ¶æ€</h3>
                <div id="currentKeys">æ— æŒ‰é”®æŒ‰ä¸‹</div>
                <br>
                <h3>â±ï¸ æœ€åæŒ‰é”®äº‹ä»¶</h3>
                <div>æŒ‰é”®: <span id="lastKey">-</span></div>
                <div>äº‹ä»¶: <span id="lastEvent">-</span></div>
                <div>æ—¶é—´: <span id="lastTime">-</span></div>
                <div>ä»£ç : <span id="lastCode">-</span></div>
            </div>
        </div>

        <div class="debug-panel">
            <h3>ğŸ“ äº‹ä»¶æ—¥å¿—</h3>
            <div class="event-log" id="eventLog"></div>
            <button class="clear-button" onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
        </div>

        <div class="debug-panel">
            <h3>â„¹ï¸ ä½¿ç”¨è¯´æ˜</h3>
            <ul style="line-height: 1.6;">
                <li><strong>WASDé”®</strong>: æ¸¸æˆä¸­çš„ç§»åŠ¨æ§åˆ¶é”®</li>
                <li><strong>Shifté”®</strong>: åŠ é€ŸåŠŸèƒ½é”®</li>
                <li><strong>Spaceé”®</strong>: å°„å‡»åŠŸèƒ½é”®</li>
                <li><strong>æ–¹å‘é”®</strong>: å¤‡ç”¨ç§»åŠ¨æ§åˆ¶é”®</li>
                <li>æŒ‰ä¸‹ä»»æ„é”®æŸ¥çœ‹å®æ—¶åé¦ˆå’Œç»Ÿè®¡ä¿¡æ¯</li>
                <li>æ‰€æœ‰æŒ‰é”®äº‹ä»¶éƒ½ä¼šè®°å½•åœ¨äº‹ä»¶æ—¥å¿—ä¸­</li>
            </ul>
        </div>
    </div>

    <script>
        // æŒ‰é”®çŠ¶æ€è·Ÿè¸ª
        const keyStates = {};
        const keyStats = {
            KeyW: 0, KeyA: 0, KeyS: 0, KeyD: 0,
            ShiftLeft: 0, ShiftRight: 0, Space: 0
        };
        
        let eventCount = 0;
        const maxLogEntries = 100;

        // é”®ç›˜äº‹ä»¶ç›‘å¬
        document.addEventListener('keydown', (e) => {
            handleKeyEvent(e, 'keydown');
        });

        document.addEventListener('keyup', (e) => {
            handleKeyEvent(e, 'keyup');
        });

        // å¤„ç†é”®ç›˜äº‹ä»¶
        function handleKeyEvent(event, type) {
            const keyCode = event.code;
            const key = event.key;
            
            // æ›´æ–°æŒ‰é”®çŠ¶æ€
            keyStates[keyCode] = (type === 'keydown');
            
            // æ›´æ–°ç»Ÿè®¡
            if (type === 'keydown' && keyStats.hasOwnProperty(keyCode)) {
                keyStats[keyCode]++;
            }
            
            // æ›´æ–°è§†è§‰åé¦ˆ
            updateKeyVisual(keyCode, type === 'keydown');
            
            // æ›´æ–°UI
            updateCurrentKeys();
            updateLastKeyInfo(keyCode, key, type);
            updateStats();
            addLogEntry(keyCode, key, type);
            
            // é˜»æ­¢æŸäº›é»˜è®¤è¡Œä¸º
            if (['Space', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(keyCode)) {
                event.preventDefault();
            }
        }

        // æ›´æ–°æŒ‰é”®è§†è§‰æ•ˆæœ
        function updateKeyVisual(keyCode, pressed) {
            const keyElement = document.querySelector(`[data-key="${keyCode}"]`);
            if (keyElement) {
                if (pressed) {
                    keyElement.classList.add('active');
                } else {
                    keyElement.classList.remove('active');
                }
            }
        }

        // æ›´æ–°å½“å‰æŒ‰é”®æ˜¾ç¤º
        function updateCurrentKeys() {
            const pressedKeys = Object.keys(keyStates).filter(key => keyStates[key]);
            const currentKeysElement = document.getElementById('currentKeys');
            
            if (pressedKeys.length === 0) {
                currentKeysElement.textContent = 'æ— æŒ‰é”®æŒ‰ä¸‹';
                currentKeysElement.style.color = '#666';
            } else {
                currentKeysElement.textContent = pressedKeys.join(' + ');
                currentKeysElement.style.color = '#00ff00';
            }
        }

        // æ›´æ–°æœ€åæŒ‰é”®ä¿¡æ¯
        function updateLastKeyInfo(keyCode, key, type) {
            document.getElementById('lastKey').textContent = key;
            document.getElementById('lastEvent').textContent = type;
            document.getElementById('lastTime').textContent = new Date().toLocaleTimeString();
            document.getElementById('lastCode').textContent = keyCode;
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const keyMap = {
                KeyW: 'W', KeyA: 'A', KeyS: 'S', KeyD: 'D',
                ShiftLeft: 'Shift', ShiftRight: 'Shift', Space: 'Space'
            };

            Object.keys(keyMap).forEach(keyCode => {
                const displayKey = keyMap[keyCode];
                const countElement = document.getElementById(`count${displayKey}`);
                const statusElement = document.getElementById(`status${displayKey}`);
                
                if (countElement) {
                    let count = keyStats[keyCode] || 0;
                    if (keyCode === 'ShiftLeft' || keyCode === 'ShiftRight') {
                        count = (keyStats.ShiftLeft || 0) + (keyStats.ShiftRight || 0);
                    }
                    countElement.textContent = count;
                }
                
                if (statusElement) {
                    const isPressed = keyStates[keyCode] || 
                        (displayKey === 'Shift' && (keyStates.ShiftLeft || keyStates.ShiftRight));
                    statusElement.textContent = isPressed ? 'æŒ‰ä¸‹' : 'é‡Šæ”¾';
                    statusElement.style.color = isPressed ? '#00ff00' : '#666';
                }
            });
        }

        // æ·»åŠ æ—¥å¿—æ¡ç›®
        function addLogEntry(keyCode, key, type) {
            const logElement = document.getElementById('eventLog');
            const timestamp = new Date().toLocaleTimeString();
            
            const entry = document.createElement('div');
            entry.className = `event-entry event-${type}`;
            entry.textContent = `[${timestamp}] ${type.toUpperCase()}: ${key} (${keyCode})`;
            
            logElement.appendChild(entry);
            
            // é™åˆ¶æ—¥å¿—æ¡ç›®æ•°é‡
            while (logElement.children.length > maxLogEntries) {
                logElement.removeChild(logElement.firstChild);
            }
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            logElement.scrollTop = logElement.scrollHeight;
        }

        // æ¸…é™¤ç»Ÿè®¡
        function clearStats() {
            Object.keys(keyStats).forEach(key => {
                keyStats[key] = 0;
            });
            updateStats();
        }

        // æ¸…é™¤æ—¥å¿—
        function clearLog() {
            document.getElementById('eventLog').innerHTML = '';
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            updateCurrentKeys();
            updateStats();
            
            // æ·»åŠ æ¬¢è¿æ¶ˆæ¯
            addLogEntry('System', 'System', 'info');
            document.querySelector('.event-entry:last-child').textContent = 
                `[${new Date().toLocaleTimeString()}] é”®ç›˜è°ƒè¯•å·¥å…·å·²å¯åŠ¨ï¼Œè¯·æŒ‰ä»»æ„é”®å¼€å§‹æµ‹è¯•`;
        });

        // é˜²æ­¢é¡µé¢å¤±å»ç„¦ç‚¹æ—¶çš„é—®é¢˜
        window.addEventListener('blur', () => {
            // æ¸…é™¤æ‰€æœ‰æŒ‰é”®çŠ¶æ€
            Object.keys(keyStates).forEach(key => {
                keyStates[key] = false;
                updateKeyVisual(key, false);
            });
            updateCurrentKeys();
            updateStats();
        });
    </script>
</body>
</html>
