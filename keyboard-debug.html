<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>键盘输入调试工具</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
        }

        .debug-panel {
            background: rgba(0, 255, 0, 0.1);
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .keyboard-layout {
            display: grid;
            gap: 5px;
            margin: 20px 0;
            justify-content: center;
        }

        .keyboard-row {
            display: flex;
            gap: 5px;
            justify-content: center;
        }

        .key {
            background: #333;
            border: 2px solid #555;
            color: #ccc;
            padding: 10px;
            border-radius: 5px;
            min-width: 40px;
            text-align: center;
            font-family: monospace;
            font-weight: bold;
            transition: all 0.1s ease;
        }

        .key.active {
            background: #00ff00;
            color: #000;
            box-shadow: 0 0 15px #00ff00;
            transform: scale(1.1);
        }

        .key.wide {
            min-width: 80px;
        }

        .key.extra-wide {
            min-width: 120px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .info-panel {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00ff00;
            border-radius: 8px;
            padding: 15px;
        }

        .event-log {
            background: #000;
            border: 2px solid #00ff00;
            border-radius: 8px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }

        .event-entry {
            margin: 2px 0;
            padding: 2px 5px;
        }

        .event-keydown {
            color: #00ff00;
        }

        .event-keyup {
            color: #ff6600;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
        }

        .stats-table th,
        .stats-table td {
            border: 1px solid #00ff00;
            padding: 8px;
            text-align: left;
        }

        .stats-table th {
            background: rgba(0, 255, 0, 0.2);
        }

        .clear-button {
            background: #ff3333;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-family: monospace;
            font-weight: bold;
        }

        .clear-button:hover {
            background: #ff5555;
        }

        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 255, 0, 0.2);
            border: 2px solid #00ff00;
            color: #00ff00;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(0, 255, 0, 0.3);
            box-shadow: 0 0 10px #00ff00;
        }
    </style>
</head>
<body>
    <a href="demo.html" class="back-button">← 返回演示页面</a>
    
    <div class="container">
        <h1>⌨️ 键盘输入调试工具</h1>
        
        <div class="debug-panel">
            <h2>🎮 游戏控制键位</h2>
            <div class="keyboard-layout">
                <div class="keyboard-row">
                    <div class="key" data-key="KeyQ">Q</div>
                    <div class="key" data-key="KeyW">W</div>
                    <div class="key" data-key="KeyE">E</div>
                    <div class="key" data-key="KeyR">R</div>
                </div>
                <div class="keyboard-row">
                    <div class="key" data-key="KeyA">A</div>
                    <div class="key" data-key="KeyS">S</div>
                    <div class="key" data-key="KeyD">D</div>
                    <div class="key" data-key="KeyF">F</div>
                </div>
                <div class="keyboard-row">
                    <div class="key wide" data-key="ShiftLeft">Shift</div>
                    <div class="key extra-wide" data-key="Space">Space</div>
                    <div class="key wide" data-key="ShiftRight">Shift</div>
                </div>
                <div class="keyboard-row">
                    <div class="key" data-key="ArrowUp">↑</div>
                    <div class="key" data-key="ArrowDown">↓</div>
                    <div class="key" data-key="ArrowLeft">←</div>
                    <div class="key" data-key="ArrowRight">→</div>
                </div>
            </div>
        </div>

        <div class="info-grid">
            <div class="info-panel">
                <h3>📊 按键统计</h3>
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>按键</th>
                            <th>按下次数</th>
                            <th>状态</th>
                        </tr>
                    </thead>
                    <tbody id="statsTable">
                        <tr><td>W (上)</td><td id="countW">0</td><td id="statusW">释放</td></tr>
                        <tr><td>A (左)</td><td id="countA">0</td><td id="statusA">释放</td></tr>
                        <tr><td>S (下)</td><td id="countS">0</td><td id="statusS">释放</td></tr>
                        <tr><td>D (右)</td><td id="countD">0</td><td id="statusD">释放</td></tr>
                        <tr><td>Shift (加速)</td><td id="countShift">0</td><td id="statusShift">释放</td></tr>
                        <tr><td>Space (射击)</td><td id="countSpace">0</td><td id="statusSpace">释放</td></tr>
                    </tbody>
                </table>
                <button class="clear-button" onclick="clearStats()">清除统计</button>
            </div>

            <div class="info-panel">
                <h3>🔍 当前按键状态</h3>
                <div id="currentKeys">无按键按下</div>
                <br>
                <h3>⏱️ 最后按键事件</h3>
                <div>按键: <span id="lastKey">-</span></div>
                <div>事件: <span id="lastEvent">-</span></div>
                <div>时间: <span id="lastTime">-</span></div>
                <div>代码: <span id="lastCode">-</span></div>
            </div>
        </div>

        <div class="debug-panel">
            <h3>📝 事件日志</h3>
            <div class="event-log" id="eventLog"></div>
            <button class="clear-button" onclick="clearLog()">清除日志</button>
        </div>

        <div class="debug-panel">
            <h3>ℹ️ 使用说明</h3>
            <ul style="line-height: 1.6;">
                <li><strong>WASD键</strong>: 游戏中的移动控制键</li>
                <li><strong>Shift键</strong>: 加速功能键</li>
                <li><strong>Space键</strong>: 射击功能键</li>
                <li><strong>方向键</strong>: 备用移动控制键</li>
                <li>按下任意键查看实时反馈和统计信息</li>
                <li>所有按键事件都会记录在事件日志中</li>
            </ul>
        </div>
    </div>

    <script>
        // 按键状态跟踪
        const keyStates = {};
        const keyStats = {
            KeyW: 0, KeyA: 0, KeyS: 0, KeyD: 0,
            ShiftLeft: 0, ShiftRight: 0, Space: 0
        };
        
        let eventCount = 0;
        const maxLogEntries = 100;

        // 键盘事件监听
        document.addEventListener('keydown', (e) => {
            handleKeyEvent(e, 'keydown');
        });

        document.addEventListener('keyup', (e) => {
            handleKeyEvent(e, 'keyup');
        });

        // 处理键盘事件
        function handleKeyEvent(event, type) {
            const keyCode = event.code;
            const key = event.key;
            
            // 更新按键状态
            keyStates[keyCode] = (type === 'keydown');
            
            // 更新统计
            if (type === 'keydown' && keyStats.hasOwnProperty(keyCode)) {
                keyStats[keyCode]++;
            }
            
            // 更新视觉反馈
            updateKeyVisual(keyCode, type === 'keydown');
            
            // 更新UI
            updateCurrentKeys();
            updateLastKeyInfo(keyCode, key, type);
            updateStats();
            addLogEntry(keyCode, key, type);
            
            // 阻止某些默认行为
            if (['Space', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(keyCode)) {
                event.preventDefault();
            }
        }

        // 更新按键视觉效果
        function updateKeyVisual(keyCode, pressed) {
            const keyElement = document.querySelector(`[data-key="${keyCode}"]`);
            if (keyElement) {
                if (pressed) {
                    keyElement.classList.add('active');
                } else {
                    keyElement.classList.remove('active');
                }
            }
        }

        // 更新当前按键显示
        function updateCurrentKeys() {
            const pressedKeys = Object.keys(keyStates).filter(key => keyStates[key]);
            const currentKeysElement = document.getElementById('currentKeys');
            
            if (pressedKeys.length === 0) {
                currentKeysElement.textContent = '无按键按下';
                currentKeysElement.style.color = '#666';
            } else {
                currentKeysElement.textContent = pressedKeys.join(' + ');
                currentKeysElement.style.color = '#00ff00';
            }
        }

        // 更新最后按键信息
        function updateLastKeyInfo(keyCode, key, type) {
            document.getElementById('lastKey').textContent = key;
            document.getElementById('lastEvent').textContent = type;
            document.getElementById('lastTime').textContent = new Date().toLocaleTimeString();
            document.getElementById('lastCode').textContent = keyCode;
        }

        // 更新统计信息
        function updateStats() {
            const keyMap = {
                KeyW: 'W', KeyA: 'A', KeyS: 'S', KeyD: 'D',
                ShiftLeft: 'Shift', ShiftRight: 'Shift', Space: 'Space'
            };

            Object.keys(keyMap).forEach(keyCode => {
                const displayKey = keyMap[keyCode];
                const countElement = document.getElementById(`count${displayKey}`);
                const statusElement = document.getElementById(`status${displayKey}`);
                
                if (countElement) {
                    let count = keyStats[keyCode] || 0;
                    if (keyCode === 'ShiftLeft' || keyCode === 'ShiftRight') {
                        count = (keyStats.ShiftLeft || 0) + (keyStats.ShiftRight || 0);
                    }
                    countElement.textContent = count;
                }
                
                if (statusElement) {
                    const isPressed = keyStates[keyCode] || 
                        (displayKey === 'Shift' && (keyStates.ShiftLeft || keyStates.ShiftRight));
                    statusElement.textContent = isPressed ? '按下' : '释放';
                    statusElement.style.color = isPressed ? '#00ff00' : '#666';
                }
            });
        }

        // 添加日志条目
        function addLogEntry(keyCode, key, type) {
            const logElement = document.getElementById('eventLog');
            const timestamp = new Date().toLocaleTimeString();
            
            const entry = document.createElement('div');
            entry.className = `event-entry event-${type}`;
            entry.textContent = `[${timestamp}] ${type.toUpperCase()}: ${key} (${keyCode})`;
            
            logElement.appendChild(entry);
            
            // 限制日志条目数量
            while (logElement.children.length > maxLogEntries) {
                logElement.removeChild(logElement.firstChild);
            }
            
            // 滚动到底部
            logElement.scrollTop = logElement.scrollHeight;
        }

        // 清除统计
        function clearStats() {
            Object.keys(keyStats).forEach(key => {
                keyStats[key] = 0;
            });
            updateStats();
        }

        // 清除日志
        function clearLog() {
            document.getElementById('eventLog').innerHTML = '';
        }

        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', () => {
            updateCurrentKeys();
            updateStats();
            
            // 添加欢迎消息
            addLogEntry('System', 'System', 'info');
            document.querySelector('.event-entry:last-child').textContent = 
                `[${new Date().toLocaleTimeString()}] 键盘调试工具已启动，请按任意键开始测试`;
        });

        // 防止页面失去焦点时的问题
        window.addEventListener('blur', () => {
            // 清除所有按键状态
            Object.keys(keyStates).forEach(key => {
                keyStates[key] = false;
                updateKeyVisual(key, false);
            });
            updateCurrentKeys();
            updateStats();
        });
    </script>
</body>
</html>
