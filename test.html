<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>æµ·åº•ç‹©çŒæ¸¸æˆ - ç³»ç»Ÿå…¼å®¹æ€§æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .test-item:last-child {
            border-bottom: none;
        }

        .status {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .status.pass {
            background: #4CAF50;
            color: white;
        }

        .status.fail {
            background: #f44336;
            color: white;
        }

        .status.warning {
            background: #ff9800;
            color: white;
        }

        .test-canvas {
            width: 100%;
            height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin: 10px 0;
        }

        .performance-meter {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .performance-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A, #CDDC39, #FFC107, #FF9800, #f44336);
            transition: width 0.3s ease;
        }

        .button {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            display: inline-block;
        }

        .button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .fps-counter {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .test-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŠ ç³»ç»Ÿå…¼å®¹æ€§æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>ğŸ”§ åŸºç¡€åŠŸèƒ½æ£€æµ‹</h2>
            <div class="test-item">
                <span>Canvas 2D æ”¯æŒ</span>
                <span class="status" id="canvas-status">æ£€æµ‹ä¸­...</span>
            </div>
            <div class="test-item">
                <span>è§¦æ§äº‹ä»¶æ”¯æŒ</span>
                <span class="status" id="touch-status">æ£€æµ‹ä¸­...</span>
            </div>
            <div class="test-item">
                <span>è®¾å¤‡åƒç´ æ¯”</span>
                <span class="status" id="dpr-status">æ£€æµ‹ä¸­...</span>
            </div>
            <div class="test-item">
                <span>æœ¬åœ°å­˜å‚¨æ”¯æŒ</span>
                <span class="status" id="storage-status">æ£€æµ‹ä¸­...</span>
            </div>
            <div class="test-item">
                <span>éŸ³é¢‘ä¸Šä¸‹æ–‡æ”¯æŒ</span>
                <span class="status" id="audio-status">æ£€æµ‹ä¸­...</span>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“± è®¾å¤‡ä¿¡æ¯</h2>
            <div class="info-grid">
                <div class="info-card">
                    <h3>æµè§ˆå™¨ä¿¡æ¯</h3>
                    <p id="browser-info">æ£€æµ‹ä¸­...</p>
                </div>
                <div class="info-card">
                    <h3>å±å¹•åˆ†è¾¨ç‡</h3>
                    <p id="screen-info">æ£€æµ‹ä¸­...</p>
                </div>
                <div class="info-card">
                    <h3>è®¾å¤‡ç±»å‹</h3>
                    <p id="device-info">æ£€æµ‹ä¸­...</p>
                </div>
                <div class="info-card">
                    <h3>ç½‘ç»œçŠ¶æ€</h3>
                    <p id="network-info">æ£€æµ‹ä¸­...</p>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>âš¡ æ€§èƒ½æµ‹è¯•</h2>
            <div class="fps-counter" id="fps-counter">0 FPS</div>
            <div class="performance-meter">
                <div class="performance-bar" id="performance-bar" style="width: 0%"></div>
            </div>
            <canvas class="test-canvas" id="performance-canvas"></canvas>
            <div style="text-align: center; margin-top: 15px;">
                <button class="button" onclick="startPerformanceTest()">å¼€å§‹æ€§èƒ½æµ‹è¯•</button>
                <button class="button" onclick="stopPerformanceTest()">åœæ­¢æµ‹è¯•</button>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ® æ§åˆ¶æµ‹è¯•</h2>
            <div class="test-item">
                <span>é”®ç›˜è¾“å…¥</span>
                <span class="status" id="keyboard-status">ç­‰å¾…è¾“å…¥...</span>
            </div>
            <div class="test-item">
                <span>é¼ æ ‡è¾“å…¥</span>
                <span class="status" id="mouse-status">ç­‰å¾…è¾“å…¥...</span>
            </div>
            <div class="test-item">
                <span>è§¦æ§è¾“å…¥</span>
                <span class="status" id="touch-input-status">ç­‰å¾…è¾“å…¥...</span>
            </div>
            <canvas class="test-canvas" id="input-canvas"></canvas>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š æµ‹è¯•ç»“æœ</h2>
            <div id="test-results">
                <p>æ­£åœ¨è¿›è¡Œå…¼å®¹æ€§æ£€æµ‹...</p>
            </div>
            <div style="text-align: center; margin-top: 15px;">
                <button class="button" onclick="generateReport()">ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š</button>
                <button class="button" onclick="window.location.href='index.html'">å¯åŠ¨å®Œæ•´æ¸¸æˆ</button>
                <button class="button" onclick="window.location.href='simple-game.html'">å¯åŠ¨æ¼”ç¤ºç‰ˆ</button>
            </div>
        </div>
    </div>

    <script>
        // æµ‹è¯•ç»“æœå­˜å‚¨
        const testResults = {
            canvas: false,
            touch: false,
            dpr: 1,
            storage: false,
            audio: false,
            performance: 0,
            browser: '',
            device: '',
            screen: '',
            network: ''
        };

        // æ€§èƒ½æµ‹è¯•å˜é‡
        let performanceTest = null;
        let frameCount = 0;
        let lastTime = 0;
        let fps = 0;

        // åˆå§‹åŒ–æµ‹è¯•
        document.addEventListener('DOMContentLoaded', () => {
            runCompatibilityTests();
            setupInputTests();
        });

        // è¿è¡Œå…¼å®¹æ€§æµ‹è¯•
        function runCompatibilityTests() {
            // Canvas 2D æµ‹è¯•
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                testResults.canvas = !!ctx;
                updateStatus('canvas-status', testResults.canvas);
            } catch (e) {
                updateStatus('canvas-status', false);
            }

            // è§¦æ§æ”¯æŒæµ‹è¯•
            testResults.touch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            updateStatus('touch-status', testResults.touch);

            // è®¾å¤‡åƒç´ æ¯”
            testResults.dpr = window.devicePixelRatio || 1;
            document.getElementById('dpr-status').textContent = testResults.dpr.toFixed(1);
            document.getElementById('dpr-status').className = 'status ' + (testResults.dpr >= 1 ? 'pass' : 'warning');

            // æœ¬åœ°å­˜å‚¨æµ‹è¯•
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                testResults.storage = true;
                updateStatus('storage-status', true);
            } catch (e) {
                updateStatus('storage-status', false);
            }

            // éŸ³é¢‘ä¸Šä¸‹æ–‡æµ‹è¯•
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                const audioContext = new AudioContext();
                testResults.audio = !!audioContext;
                updateStatus('audio-status', testResults.audio);
            } catch (e) {
                updateStatus('audio-status', false);
            }

            // è®¾å¤‡ä¿¡æ¯
            updateDeviceInfo();
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(elementId, passed) {
            const element = document.getElementById(elementId);
            element.textContent = passed ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ';
            element.className = 'status ' + (passed ? 'pass' : 'fail');
        }

        // æ›´æ–°è®¾å¤‡ä¿¡æ¯
        function updateDeviceInfo() {
            // æµè§ˆå™¨ä¿¡æ¯
            testResults.browser = navigator.userAgent;
            document.getElementById('browser-info').textContent = getBrowserName();

            // å±å¹•ä¿¡æ¯
            testResults.screen = `${screen.width}x${screen.height}`;
            document.getElementById('screen-info').textContent = 
                `${screen.width}x${screen.height} (${window.innerWidth}x${window.innerHeight})`;

            // è®¾å¤‡ç±»å‹
            testResults.device = getDeviceType();
            document.getElementById('device-info').textContent = testResults.device;

            // ç½‘ç»œçŠ¶æ€
            testResults.network = navigator.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿';
            if (navigator.connection) {
                testResults.network += ` (${navigator.connection.effectiveType || 'æœªçŸ¥'})`;
            }
            document.getElementById('network-info').textContent = testResults.network;
        }

        // è·å–æµè§ˆå™¨åç§°
        function getBrowserName() {
            const ua = navigator.userAgent;
            if (ua.includes('Chrome')) return 'Chrome';
            if (ua.includes('Firefox')) return 'Firefox';
            if (ua.includes('Safari')) return 'Safari';
            if (ua.includes('Edge')) return 'Edge';
            return 'æœªçŸ¥æµè§ˆå™¨';
        }

        // è·å–è®¾å¤‡ç±»å‹
        function getDeviceType() {
            const ua = navigator.userAgent;
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua)) {
                return 'ç§»åŠ¨è®¾å¤‡';
            }
            return 'PCè®¾å¤‡';
        }

        // å¼€å§‹æ€§èƒ½æµ‹è¯•
        function startPerformanceTest() {
            if (performanceTest) return;

            const canvas = document.getElementById('performance-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;

            frameCount = 0;
            lastTime = performance.now();

            performanceTest = setInterval(() => {
                // ç»˜åˆ¶æ€§èƒ½æµ‹è¯•å›¾å½¢
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                const time = performance.now() * 0.001;
                for (let i = 0; i < 50; i++) {
                    ctx.fillStyle = `hsl(${(time * 100 + i * 10) % 360}, 70%, 60%)`;
                    ctx.beginPath();
                    ctx.arc(
                        Math.sin(time + i * 0.1) * 100 + canvas.width / 2,
                        Math.cos(time + i * 0.1) * 50 + canvas.height / 2,
                        5 + Math.sin(time * 2 + i) * 3,
                        0, Math.PI * 2
                    );
                    ctx.fill();
                }

                frameCount++;
                const currentTime = performance.now();
                if (currentTime - lastTime >= 1000) {
                    fps = Math.round(frameCount * 1000 / (currentTime - lastTime));
                    frameCount = 0;
                    lastTime = currentTime;
                    
                    document.getElementById('fps-counter').textContent = fps + ' FPS';
                    const performancePercent = Math.min(fps / 60 * 100, 100);
                    document.getElementById('performance-bar').style.width = performancePercent + '%';
                    
                    testResults.performance = fps;
                }
            }, 16);
        }

        // åœæ­¢æ€§èƒ½æµ‹è¯•
        function stopPerformanceTest() {
            if (performanceTest) {
                clearInterval(performanceTest);
                performanceTest = null;
            }
        }

        // è®¾ç½®è¾“å…¥æµ‹è¯•
        function setupInputTests() {
            const canvas = document.getElementById('input-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;

            // é”®ç›˜æµ‹è¯•
            document.addEventListener('keydown', () => {
                document.getElementById('keyboard-status').textContent = 'âœ… æ­£å¸¸';
                document.getElementById('keyboard-status').className = 'status pass';
            });

            // é¼ æ ‡æµ‹è¯•
            canvas.addEventListener('mousemove', (e) => {
                document.getElementById('mouse-status').textContent = 'âœ… æ­£å¸¸';
                document.getElementById('mouse-status').className = 'status pass';
                
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.beginPath();
                ctx.arc(x, y, 10, 0, Math.PI * 2);
                ctx.fill();
            });

            // è§¦æ§æµ‹è¯•
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                document.getElementById('touch-input-status').textContent = 'âœ… æ­£å¸¸';
                document.getElementById('touch-input-status').className = 'status pass';
                
                const rect = canvas.getBoundingClientRect();
                const touch = e.touches[0];
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                
                ctx.fillStyle = 'rgba(255, 100, 100, 0.3)';
                ctx.beginPath();
                ctx.arc(x, y, 15, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
        function generateReport() {
            const results = document.getElementById('test-results');
            let report = '<h3>ğŸ“‹ å…¼å®¹æ€§æµ‹è¯•æŠ¥å‘Š</h3>';
            
            const score = calculateCompatibilityScore();
            report += `<p><strong>å…¼å®¹æ€§è¯„åˆ†: ${score}/100</strong></p>`;
            
            if (score >= 80) {
                report += '<p style="color: #4CAF50;">âœ… ç³»ç»Ÿå®Œå…¨å…¼å®¹ï¼Œå¯ä»¥æµç•…è¿è¡Œæ¸¸æˆ</p>';
            } else if (score >= 60) {
                report += '<p style="color: #ff9800;">âš ï¸ ç³»ç»ŸåŸºæœ¬å…¼å®¹ï¼Œå¯èƒ½å­˜åœ¨æ€§èƒ½é—®é¢˜</p>';
            } else {
                report += '<p style="color: #f44336;">âŒ ç³»ç»Ÿå…¼å®¹æ€§è¾ƒå·®ï¼Œå»ºè®®å‡çº§æµè§ˆå™¨æˆ–è®¾å¤‡</p>';
            }
            
            report += '<ul>';
            report += `<li>Canvas 2D: ${testResults.canvas ? 'âœ…' : 'âŒ'}</li>`;
            report += `<li>è§¦æ§æ”¯æŒ: ${testResults.touch ? 'âœ…' : 'âŒ'}</li>`;
            report += `<li>æ€§èƒ½è¡¨ç°: ${testResults.performance} FPS</li>`;
            report += `<li>è®¾å¤‡ç±»å‹: ${testResults.device}</li>`;
            report += `<li>æµè§ˆå™¨: ${getBrowserName()}</li>`;
            report += '</ul>';
            
            results.innerHTML = report;
        }

        // è®¡ç®—å…¼å®¹æ€§è¯„åˆ†
        function calculateCompatibilityScore() {
            let score = 0;
            
            if (testResults.canvas) score += 25;
            if (testResults.touch) score += 15;
            if (testResults.storage) score += 10;
            if (testResults.audio) score += 10;
            if (testResults.dpr >= 1) score += 10;
            
            // æ€§èƒ½è¯„åˆ†
            if (testResults.performance >= 50) score += 20;
            else if (testResults.performance >= 30) score += 15;
            else if (testResults.performance >= 15) score += 10;
            
            // è®¾å¤‡ç±»å‹è¯„åˆ†
            if (testResults.device === 'PCè®¾å¤‡') score += 10;
            else score += 5;
            
            return Math.min(score, 100);
        }
    </script>
</body>
</html>
